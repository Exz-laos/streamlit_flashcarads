import streamlit as st
from gtts import gTTS
import io

# --- Данные для карточек (Полный список) ---
flashcard_data = {
    "Билет 1: Особенности зарождения капиталистических отношений в Западной Европе в XVI-XVII вв.":
        "Процесс перехода от феодализма к капитализму в XVI-XVII веках был ускорен Великими географическими открытиями, которые сместили торговые пути в Атлантику. Ключевыми явлениями стали «революция цен», обогатившая буржуазию за счёт притока дешёвого американского золота, и появление мануфактур — крупного ручного производства, основанного на разделении труда. Эти изменения привели к формированию новых классов — буржуазии и наёмных работников, а «образцовыми» капиталистическими странами стали Голландия и Англия.",
    "Билет 2: Европа после исчезновения Бургундии. Два полюса богатства. Основные черты и внешнеполитические противоречия Европы XVI века.":
        "Исчезновение Бургундии в 1477 году положило начало долгому соперничеству династий Валуа и Габсбургов за гегемонию в Европе, вылившемуся в Итальянские войны (1494-1559). В экономике произошёл сдвиг от старого средиземноморского полюса богатства (Венеция, Генуя) к новому, атлантическому, где доминировали Испания и Португалия. Главными узлами международных противоречий XVI века были: борьба Франции и Габсбургов, противостояние христианской Европы и Османской империи, а также нарастающий англо-испанский конфликт.",
    # ... (Я добавлю все остальные билеты сюда для полноты)
    "Билет 3: Реформация в Англии. Англо-испанские противоречия. Новая роль Англии после разгрома «Непобедимой армады».": "Английская Реформация была революцией «сверху», инициированной королём Генрихом VIII ради укрепления власти и секуляризации церковных земель. «Акт о супрематии» 1534 года провозгласил монарха главой церкви, а при Елизавете I окончательно оформилось англиканское вероучение в «39 статьях». Религиозные, экономические и политические противоречия с католической Испанией привели к походу «Непобедимой армады» в 1588 году. Победа над ней положила начало упадку Испании и возвышению Англии как великой морской державы.",
    "Билет 4: Противоречия Европы и Османской империи": "Противостояние с Османской империей было столкновением цивилизаций, обострившимся после падения Константинополя в 1453 году. Конфликт развивался по трём направлениям: религиозно-цивилизационному (ислам против христианства), военно-политическому (экспансия турок на Балканах, осада Вены в 1529 г.) и экономическому. Блокирование османами средиземноморской торговли стало мощным катализатором Великих географических открытий, заставив европейцев искать альтернативные пути на Восток.",
    "Билет 5: Голландия «образцовая» капиталистическая страна XVII века": "Голландия в XVII веке стала «образцовой капиталистической страной» благодаря победе в буржуазной революции, которая привела к власти купеческую олигархию. Страна доминировала в мировой торговле благодаря мощному флоту, технологичному судну (флейту) и деятельности Ост-Индской компании. Финансовым центром мира стал Амстердам с его банком (1609) и первой в мире фондовой биржей (1602). Упадок Голландии начался из-за роста конкурентов и протекционистской политики Англии, в частности Навигационного акта 1651 года.",
    "Билет 6: Предпосылки восстания в Нидерландах. Специфика буржуазной революции в Нидерландах.": "Специфика Нидерландской революции заключалась в том, что она одновременно была буржуазной революцией, национально-освободительной войной против Испании и религиозной борьбой в форме кальвинизма. Предпосылками к восстанию стали ущемление испанским королём Филиппом ІІ политической автономии провинций, жестокие гонения на протестантов-кальвинистов со стороны инквизиции и тяжёлый финансовый гнёт. Казнь графов Эгмонта и Горна в 1568 году стала толчком к началу всеобщего вооружённого восстания.",
    "Билет 7: Основные этапы национально-освободительного движения в Нидерландах. Итоги буржуазной революции в Нидерландах.": "Восстание в Нидерландах (Восьмидесятилетняя война) началось с террора герцога Альбы и партизанской войны гёзов, а всеобщее восстание на севере вспыхнуло после захвата гёзами города Бриль в 1572 г.. Ключевым этапом стал раскол страны в 1579 г. на южную Аррасскую унию, заключившую мир с Испанией, и северную Утрехтскую унию, ставшую ядром будущего государства. Главным итогом революции стало рождение на севере первой в Европе буржуазной республики, где были созданы все условия для бурного развития капитализма. Международное признание независимости было получено по Вестфальскому миру 1648 года.",
    "Билет 8: Последствия Великих географических открытий и «революции цен» для экономического развития основных стран Западной Европы": "Великие географические открытия привели к перемещению торговых путей из Средиземноморья в Атлантику, что вызвало упадок итальянских городов и возвышение атлантических портов, таких как Лиссабон и Лондон. Приток дешёвого американского золота и серебра в XVI веке спровоцировал «революцию цен» — резкий рост цен на все товары. От этого выиграла нарождающаяся буржуазия (торговцы, производители), а проиграли феодалы, жившие на фиксированную ренту, и наёмные работники. Обогащение буржуазии стало основой первоначального накопления капитала, который вкладывался в создание мануфактур и развитие торговли.",
    "Билет 9: Западноевропейский абсолютизм второй трети XVI - начала XVII в. Специфика становления национальных форм абсолютизма (Англия, Франция, Германия, Испания).": "Абсолютизм — это форма правления с неограниченной властью монарха, но в каждой стране он имел свои особенности. Классической моделью считается французский абсолютизм с его разветвлённой бюрократией, сильной армией и контролем над экономикой (меркантилизм). Английский абсолютизм был «незавершённым» из-за сохранения сильного парламента, отсутствия большой постоянной армии и наличия мощного местного самоуправления. В Испании он был тесно связан с церковью и притоком колониального золота, а в Германии единый абсолютизм не сложился, уступив место «княжескому» абсолютизму в отдельных государствах.",
    "Билет 10: Особенности становления и развития мануфактурного капитализма в Англии": "Становление мануфактурного капитализма в Англии было обусловлено процессом первоначального накопления капитала. Капитал формировался за счёт внешних источников (пиратство, работорговля) и внутренних, главным из которых были огораживания — насильственный сгон крестьян с земли. Огораживания одновременно создавали армию дешёвой рабочей силы и приносили прибыль лендлордам от продажи шерсти, на которую был огромный спрос в Европе. Преобладающей формой мануфактуры была рассеянная, позволявшая обойти цеховые ограничения, а централизованная развивалась в судостроении и металлургии.",
    "Билет 11: Основные предпосылки Тридцатилетней войны, ее основные этапы. Итоги войны.": "Тридцатилетняя война (1618-1648) была вызвана религиозно-политическими противоречиями в Священной Римской империи, борьбой против гегемонии Габсбургов и экономическими интересами Дании и Швеции на Балтике. Война прошла четыре этапа: Чешско-Пфальцский, Датский, Шведский и Франко-шведский, на последнем из которых католическая Франция воевала против католических Габсбургов, что показало деидеологизацию конфликта. Итогом войны стал Вестфальский мир 1648 года, закрепивший победу Франции и Швеции, политическую раздробленность Германии и утвердивший принцип государственного суверенитета в Европе.",
    "Билеты 12-13: Вестфальский мир и принципы Вестфальской системы МО": "Вестфальский мир 1648 года не просто завершил Тридцатилетнюю войну, но и заложил фундамент новой системы международных отношений (МО). Он закрепил территориальные приобретения Франции и Швеции, признал независимость Голландии и Швейцарии и окончательно зафиксировал раздробленность Германии. Ключевыми принципами Вестфальской системы стали: государственный суверенитет, приоритет национального интереса над религией (деидеологизация) и баланс сил как главный механизм поддержания порядка, не позволяющий одной державе доминировать над остальными.",
    "Билет 14: Причины, основные этапы и итоги английской буржуазной революции": "Английская революция XVII века была вызвана конфликтом между королём, стремившимся к абсолютизму, и парламентом, а также религиозным противостоянием англикан и пуритан. Начавшись с мирного «конституционного этапа» (Долгий парламент), она переросла в гражданскую войну, в которой армия «нового образца» Оливера Кромвеля одержала победу. Кульминацией стали казнь короля Карла I в 1649 году и установление республики, которая затем сменилась военной диктатурой — Протекторатом Кромвеля. Несмотря на Реставрацию монархии в 1660 году, революция навсегда уничтожила абсолютизм и открыла путь для развития капитализма.",
    "Билет 15: Специфика первоначального накопления капитала в Англии": "Суть первоначального накопления капитала (ПНК) — это насильственное отделение крестьян от земли, что создаёт капитал и армию наёмных рабочих. Специфика Англии заключалась в том, что ключевую роль играли огораживания, вызванные огромным спросом на шерсть, которые одновременно решали обе задачи ПНК. Другими источниками капитала были пиратство, работорговля и система государственного долга. Государство же принуждало лишённых земли крестьян к наёмному труду с помощью жестокого «кровавого законодательства» против броджничества.",
    "Билет 16: Роль политики абсолютизма и меркантилизма в странах Европы в процессе формирования национальных рынков и национальных хозяйств": "Меркантилизм был экономической доктриной эпохи абсолютизма, направленной на накопление золота в казне через достижение положительного торгового баланса. Классическим примером стал «кольбертизм» во Франции, где Жан-Батист Кольбер вводил протекционистские тарифы, поддерживал мануфактуры и развивал инфраструктуру для создания единого национального рынка. В Англии монархи поощряли экспорт готового сукна, а не сырой шерсти, и запрещали вывоз живых овец для сохранения монополии. Эта политика способствовала преодолению феодальной раздробленности и развитию промышленности.",
    "Билет 17: Формирование структуры дипломатических отношений в конце XVII века": "Формирование профессиональной дипломатии стало прямым следствием Вестфальской системы, основанной на суверенитете и национальном интересе. На смену временным посланникам пришли постоянные посольства для непрерывного сбора информации и ведения переговоров. Для управления этой сетью во Франции, ставшей образцом для Европы, было создано первое ведомство иностранных дел. Дипломатия стала профессией, требующей специальных знаний, а языком международного общения вместо латыни стал французский.",
    "Билет 18: Формирование национальных интересов и баланса сил в XVIII веке": "В XVIII веке внешней политикой государств двигал прагматичный национальный интерес (безопасность, богатство), а не религиозная солидарность. Главным механизмом поддержания порядка стал баланс сил, при котором государства через союзы не давали одной державе (гегемону) чрезмерно усилиться. Ярким примером работы этой системы стала «Дипломатическая революция» 1756 года, когда вековые враги Франция и Австрия объединились против новой угрозы в лице Пруссии, а Британия заключила союз с Пруссией для борьбы с Францией. Это показало, что национальные интересы стали важнее традиций.",
    "Билет 19: Основные международные конфликты XVIII века до Великой французской революции": "Конфликты XVIII века были «кабинетными войнами», которые велись для «калибровки» баланса сил, а не на уничтожение. Характерной чертой стали «войны за наследство» (испанское, австрийское), где династический спор был лишь поводом скрыть борьбу против усиления одного из государств. Ключевыми конфликтами были Великая Северная война (возвышение России), Война за испанское наследство (утверждение баланса сил) и Семилетняя война — первый глобальный конфликт, утвердивший колониальное господство Британии. Особым случаем стали Разделы Речи Посполитой, где сильные державы договорились о ликвидации слабого государства.",
    "Билет 20: Война за испанское наследство (1701-1714)": "Война за испанское наследство была вызвана угрозой объединения корон Франции и Испании под властью династии Бурбонов после смерти бездетного испанского короля Карла II. Против Франции немедленно была создана коалиция во главе с Англией и Австрией, чтобы сохранить баланс сил. Война завершилась Утрехтским и Раштаттским мирами, по которым внук Людовика XIV Филипп V был признан королём Испании, но навсегда отказывался от прав на французский престол. Главным выгодоприобретателем стала Великобритания, получившая от Испании Гибралтар и право «асьенто» на торговлю рабами.",
    "Билет 21: Политические итоги Семилетней войны (1756-1763)": "Семилетняя война была глобальным конфликтом между коалицией Британии и Пруссии с одной стороны и союзом Франции, Австрии и России с другой. Её главными причинами были англо-французское колониальное соперничество и австро-прусская борьба за Силезию. Ключевым моментом стал выход России из войны после смерти императрицы Елизаветы, что спасло Пруссию от разгрома. Главным победителем стала Великобритания, получившая от Франции Канаду и почти все владения в Индии, а главным проигравшим — Франция, потерявшая свою первую колониальную империю.",
    "Билет 22: Американская революция (1775-1783). Война за независимость и образование США.": "Американская революция была вызвана попытками Британии ввести прямые налоги в колониях («Нет налогам без представительства!») и её карательными «Нестерпимыми законами». 4 июля 1776 года Континентальный конгресс принял Декларацию независимости, а переломным моментом в войне стала победа американцев в битве при Саратоге (1777), после которой в войну на стороне США вступила Франция. Война завершилась победой и признанием независимости США по Версальскому миру 1783 года, а итогом стало создание сильной федеративной республики на основе Конституции 1787 года.",
    "Билет 23: Характерные черты системы международных отношений к началу XVIII века": "Система МО начала XVIII века, порождённая Вестфальским миром, базировалась на принципе государственного суверенитета, который, однако, на практике часто нарушался великими державами в отношении слабых. Главным механизмом регулирования стал баланс сил, где особую роль «балансира» часто играла Великобритания, а главной угрозой гегемонии, против которой выстраивались коалиции, была Франция. Ключевыми узлами противоречий были англо-французская борьба за колонии, австро-прусское соперничество в Германии и усиление России в Восточной Европе.",
    "Билет 24: Предпосылки и основные этапы промышленного переворота в Англии": "Промышленный переворот в Англии стал возможен благодаря аграрному перевороту (огораживаниям), который создал армию свободной рабочей силы и капитал для инвестиций. Начавшись в 1760-х годах в новой, свободной от цеховых правил хлопчатобумажной промышленности, он прошёл несколько этапов. Ключевыми изобретениями стали прялка «Дженни», ткацкий станок Картрайта и, главное, универсальная паровая машина Джеймса Уатта (1784), которая произвела революцию в энергетике и транспорте (пароход, паровоз).",
    "Билет 25: Технические и социальные последствия промышленного переворота в Англии": "Главным техническим последствием промышленного переворота стала смена мануфактуры фабрикой, что превратило Англию в индустриальную «мастерскую мира». Это привело к массовой урбанизации, то есть стремительному росту промышленных городов, таких как Манчестер. Социальная структура общества изменилась: сформировались два новых класса — промышленная буржуазия и промышленный пролетариат. Тяжёлые условия труда рабочих породили новые формы борьбы — от стихийного луддизма (разрушения машин) до первого массового политического движения рабочего класса — чартизма.",
    "Билет 26: Характерные черты социально-экономического развития Франции в конце XVIII века": "Франция конца XVIII века была страной глубоких противоречий, известной как «Старый порядок». Более 80% населения составляли крестьяне, страдавшие от феодальных повинностей и несправедливой налоговой системы, где от налогов были освобождены дворянство и духовенство. В 1780-х годах системный кризис обострился из-за банкротства государства (вызванного тратами на войны), торгово-промышленного кризиса и катастрофического неурожая 1788 года, приведшего к голоду. В попытке решить финансовые проблемы король Людовик XVI был вынужден созвать Генеральные штаты, что и стало толчком к революции.",
    "Билет 27: Экономические и политические предпосылки Великой французской буржуазной революции": "Экономическими предпосылками революции были упадок сельского хозяйства из-за феодальных повинностей и несправедливых налогов, а также острый кризис 1780-х, вызванный голодом и разорением мануфактур. Политическими причинами стали банкротство и неспособность абсолютной монархии к реформам, а также рост самосознания третьего сословия, вдохновлённого идеями Просвещения (Руссо, Монтескьё) и примером Американской революции. Созыв королём Генеральных штатов в 1789 году стал политическим катализатором, который дал трибуну третьему сословию и сделал революцию неизбежной.",
    "Билет 28: Основные этапы Великой французской буржуазной революции и их характеристика": "Революция прошла 4 этапа. Первый (1789-1792) — период конституционной монархии, когда были приняты «Декларация прав человека и гражданина» и Конституция 1791 г. Второй (1792-1793) — Жирондистская республика, отмеченная казнью короля Людовика XVI и началом революционных войн. Третий (1793-1794) — Якобинская диктатура во главе с Робеспьером, пик революции с радикальными реформами и массовым террором. Четвёртый (1794-1799) — период Директории, время политической нестабильности, завершившееся переворотом 18 брюмера, который привёл к власти Наполеона Бонапарта.",
    "Билет 29: Историческое значение Великой французской революции": "Для Франции революция окончательно уничтожила «Старый порядок», решила аграрный вопрос в пользу крестьян-собственников и создала условия для капиталистического развития. Всемирно-историческое значение заключается в том, что она стала классической моделью для всех последующих революций и распространила по миру идеи гражданского равенства и нации как содружества свободных граждан. Важнейшей особенностью революции, в отличие от английской, был её светский характер, основанный на рационалистических идеях Просвещения, а не на религии.",
    "Билеты 30-31: Экономическое и политическое развитие Франции в годы Консульства и Империи. Внутренняя политика Наполеона.": "Сутью внутренней политики Наполеона было закрепление выгодных буржуазии и крестьянству итогов революции при ликвидации её политических свобод. Он провёл административную реформу, создав жёсткую вертикаль власти с назначаемыми префектами, и установил авторитарный режим, ставший в 1804 г. империей. Была проведена финансовая стабилизация через учреждение Банка Франции, а величайшим наследием стали кодексы, в первую очередь Гражданский кодекс 1804 года, закрепивший равенство перед законом и священность частной собственности.",
    "Билет 32: Внешняя политика Наполеона": "Внешняя политика Наполеона была направлена на установление гегемонии Франции в Европе. Центральным было противостояние с Великобританией, которое после Трафальгарского сражения (1805) перешло в форму экономической войны — Континентальной блокады, запрещавшей торговлю с Англией. Для обеспечения блокады Наполеон перекраивал карту Европы, создавая зависимые королевства во главе со своими родственниками. При этом на завоёванных территориях он вводил Гражданский кодекс и отменял феодальные порядки, что, с одной стороны, несло прогресс, а с другой — пробуждало национально-освободительные движения против самих французов.",
    "Билет 33: Итоги Венского конгресса 1814-1815 гг.": "Венский конгресс подвёл итоги Наполеоновских войн, а ключевые решения принимались «большой четвёркой» (Россия, Австрия, Британия, Пруссия), к которой присоединился гениальный дипломат Талейран от Франции. Была перекроена карта Европы: создано Царство Польское в составе России, усилены Пруссия и Нидерланды, а Италия и Германия остались раздробленными. Новая «Венская система» международных отношений была основана на принципах легитимизма (восстановления свергнутых династий) и баланса сил. Для её поддержания были созданы Четверной союз (военный) и Священный союз (идеологический).",
    "Билет 35: Формирование основных идейно-политических течений: консерватизм, либерализм, социализм": "Под влиянием Французской и Промышленной революций сформировались три ведущие идеологии. Либерализм (Локк, Смит) провозгласил высшей ценностью свободу личности и её естественные права. Консерватизм (Бёрк), возникнув как реакция на революцию, отстаивал ценность традиций, стабильности и постепенных реформ. Социализм (Оуэн, Маркс), ставший ответом на эксплуатацию рабочих, выдвинул на первый план общественное благо и социальное равенство, критикуя частную собственность.",
    "Билет 36: Франция в годы Реставрации": "Период Реставрации Бурбонов (1814-1830) был попыткой компромисса, основанного на дарованной Людовиком XVIII Хартии 1814 года. Она устанавливала конституционную монархию и, что самое важное, гарантировала неприкосновенность собственности, приобретённой в годы революции. Однако его преемник Карл Х, лидер ультрароялистов, взял курс на реакцию, приняв скандальный «закон о миллиарде для эмигрантов». Его Июльские ордонансы 1830 года, отменявшие свободы, вызвали революцию («три славных дня»), которая свергла Бурбонов и привела к власти Луи-Филиппа Орлеанского.",
    "Билет 37: Революция 1848-1849 гг. во Франции": "Революция 1848 года была вызвана кризисом Июльской монархии, выражавшей интересы лишь финансовой аристократии, и экономическим кризисом 1847 года. Восстание в феврале 1848 г. свергло короля Луи-Филиппа и привело к провозглашению Второй республики. Переломным моментом стало жестокое подавление Июньского восстания парижских рабочих, что оттолкнуло от республики буржуазию и крестьянство, напуганных «красной угрозой». В итоге на президентских выборах победил Луи-Наполеон Бонапарт, который в 1851 г. совершил госпереворот, а в 1852 г. провозгласил себя императором Наполеоном III.",
    "Билет 38: Франция в годы Второй империи (1852-1870)": "Режим Второй империи Наполеона III получил название «бонапартизм» — авторитарная диктатура, лавирующая между интересами разных классов. Его главной опорой были крестьяне-собственники, видевшие в имени Бонапарта гарантию порядка и своей земли, а также крупная буржуазия и армия. Внутренняя политика прошла путь от авторитарной (1850-е) к либеральной (1860-е) империи с уступками и реформами. Авантюрная внешняя политика (Крымская война, война в Италии, мексиканская авантюра) в итоге привела к столкновению с Пруссией, поражению при Седане и краху режима.",
    "Билет 39: Учреждение Третьей республики во Франции": "Третья республика была провозглашена 4 сентября 1870 года после известия о пленении Наполеона III при Седане. Однако на выборах 1871 года победили монархисты, так как крестьяне голосовали за мир, который обещали консерваторы. Монархисты во главе с Адольфом Тьером намеренно позволили республике подписать унизительный мир с Германией, надеясь дискредитировать саму республиканскую идею. Реставрация монархии провалилась из-за раскола самих монархистов, и в 1875 г. с перевесом в один голос были приняты Конституционные законы, юридически оформившие республику.",
    "Билет 40: Последствия франко-прусской войны для экономики Франции": "Поражение в войне имело тяжёлые экономические последствия: Франция потеряла Эльзас (текстиль) и Лотарингию (металлургия), свои самые развитые промышленные регионы, и была обязана выплатить контрибуцию в 5 млрд франков. Однако процесс досрочной выплаты контрибуции, осуществлённый за счёт всенародных займов, имел и неожиданный положительный эффект. Он продемонстрировал финансовую мощь страны, укрепил её международный авторитет и, что важно, значительно повысил престиж нового республиканского правительства в глазах нации.",
    "Билет 43: Экономическое развитие Великобритании в Викторианскую эпоху (1837-1901)": "В Викторианскую эпоху Британия была «мастерской мира», её промышленная гегемония была продемонстрирована на Всемирной выставке 1851 г. в Хрустальном дворце. Ключевым шагом стал переход к политике свободной торговли (фритрейдерству), символом чего стала отмена «Хлебных законов» в 1846 г. по инициативе Роберта Пиля. Лондонский Сити стал мировым финансовым центром, а фунт — главной валютой. К концу эпохи, столкнувшись с конкуренцией США и Германии, в британской экономике начали формироваться монополии, особенно в колониальной сфере, как алмазная империя Сесиля Родса.",
    "Билет 44: Политическое развитие Великобритании в Викторианскую эпоху (1837-1901)": "Политическая система Викторианской эпохи характеризовалась стабильностью, доминированием двухпартийной системы и постепенной демократизацией. Старые группировки тори и виги окончательно превратились в Консервативную и Либеральную партии, а политическую жизнь определяло соперничество их лидеров — Бенджамина Дизраэли и Уильяма Гладстона. Вторая (1867) и третья (1884) избирательные реформы значительно расширили число избирателей, включив в него квалифицированных рабочих и сельских жителей, а введение тайного голосования (1872) защитило их от давления.",
    "Билет 45: Формирование территории США в ХІХ веке": "Формирование континентальной территории США шло путём покупок, дипломатии и войн, под идеологией «Предопределения судьбы». Ключевыми приобретениями стали Луизианская покупка у Франции (1803), уступка Испанией Флориды (1819) и аннексия Техаса (1845). Победа в Американо-мексиканской войне (1846-1848) принесла США огромные территории, включая Калифорнию, а договор с Британией (1846) мирно определил границу в Орегоне. Процесс завершился покупкой Аляски у России в 1867 году и аннексией Гавайев в 1898, но имел трагические последствия для коренного населения.",
    "Билет 46: Причины и последствия англо-американской войны 1812-1814 гг.": "Война была вызвана нарушением Британией морских прав США, в первую очередь практикой принудительной вербовки американских моряков на британский флот, а также торговой блокадой. Со стороны США одной из целей была попытка завоевать и присоединить Канаду, которая закончилась провалом. Война завершилась Гентским миром на условиях возврата к довоенному положению, однако она вызвала в США мощный рост национального самосознания, дала толчок развитию промышленности и окончательно утвердила суверенитет страны на мировой арене.",
    "Билет 47: Формирование в США политических традиций": "Политические традиции США, не закреплённые в Конституции, оказали огромное влияние на развитие страны. Важнейшей стала заложенная Джорджем Вашингтоном традиция ограничения президентства двумя сроками, которая соблюдалась более 150 лет. Также почти сразу сформировалась двухпартийная система, начавшаяся с противостояния федералистов Гамильтона и республиканцев Джефферсона. Во внешней политике доминировала традиция изоляционизма, также завещанная Вашингтотом, — невмешательство в европейские дела и союзы.",
    "Билет 48: Социально-экономическое развитие США в первой половине ХІХ в.": "В первой половине ХІХ века США переживали бурный промышленный рост, чему способствовали богатые ресурсы, иммиграция и территориальная экспансия, как покупка Луизианы. Промышленный переворот начался в хлопчатобумажной отрасли, а ключевую роль сыграла «транспортная революция» — строительство каналов и особенно железных дорог, связавших страну. Главной особенностью стала многоукладность экономики: промышленный Север, основанный на наёмном труде, и рабовладельческий аграрный Юг. Этот конфликт интересов (по тарифам, финансам и земле) неумолимо вел страну к Гражданской войне.",
    "Билет 49: Причины и последствия доктрины Монро": "Доктрина Монро (1823) была провозглашена для предотвращения интервенции европейского Священного союза в Латинскую Америку с целью восстановить там испанское господство. Хотя её автором был госсекретарь Джон Куинси Адамс, США смогли сделать такое смелое заявление, рассчитывая на поддержку британского флота, также не заинтересованного в европейской интервенции. Принцип «Америка для американцев» стал основой изоляционистской политики США, но со временем трансформировался в идеологическое обоснование их гегемонии в Западном полушарии, получив развитие в «политике большой дубинки» Теодора Рузвельта.",
    "Билет 50: Гражданская война и Реконструкция Юга в США": "Гражданская война (1861-1865) началась с сецессии (выхода) 11 южных штатов, образовавших Конфедерацию, после избрания президентом Авраама Линкольна, выступавшего против расширения рабства. Переломным моментом стала битва при Геттисберге (1863), а «Прокламация об освобождении рабов» превратила войну в борьбу за уничтожение рабства. Последующая Реконструкция Юга была попыткой его реинтеграции; её «радикальный» этап (с 1867 г.) дал афроамериканцам гражданские и избирательные права. Реконструкция завершилась Компромиссом 1877 года, когда федеральные войска были выведены с Юга, что привело к установлению там расовой сегрегации.",
    "Билет 51: Экономическое и общественное развитие США в последней трети XIX в.": "Период после Гражданской войны, названный Марком Твеном «Позолоченный век», характеризовался бурным ростом промышленности и формированием гигантских монополий — трестов. Примерами стали нефтяной трест «Standard Oil» Джона Рокфеллера и стальная империя «U.S. Steel» Эндрю Карнеги. Это вызвало мощные протестные движения разорившихся фермеров и рабочих: движения грейнджеров (против монополии ж/д), гринбекеров (за печатание бумажных денег) и, наконец, популистов. Хотя первый антитрестовский закон Шермана был принят в 1890 г., он долгое время был малоэффективен.",
    "Билет 52: Объединение Германии (ХІХ век)": "Процесс объединения Германии был реализован «железом и кровью» под руководством Пруссии и её канцлера Отто фон Бисмарка. Экономической предпосылкой стал созданный в 1834 г. Таможенный союз, а решающий монархический путь «сверху» возобладал после провала демократического пути «снизу» в революции 1848 г.. Бисмарк последовательно осуществил объединение через три войны: с Данией (1864), с Австрией (1866), которая была исключена из германских дел, и с Францией (1870-1871). На волне победы над Францией 18 января 1871 года в Версале была провозглашена Германская империя.",
    "Билет 54: Создание Итальянского королевства": "Объединение Италии (Рисорджименто) шло двумя путями: революционно-демократическим «снизу», героем которого был Джузеппе Гарибальди, и умеренно-либеральным «сверху», который возглавлял премьер-министр Пьемонта Камилло Кавур. Ключевыми этапами стали война Пьемонта и Франции против Австрии (1859) и легендарная экспедиция «Тысячи» Гарибальди (1860), освободившая юг Италии. Гарибальди передал власть королю Виктору Эммануилу II, и 17 марта 1861 года было провозглашено Итальянское королевство. Процесс завершился присоединением Венеции (1866) и Рима (1870), который стал столицей.",
    "Билеты 55 и 57: Социально-экономическое развитие и особенности монополизации во Франции в период Третьей республики": "Экономика Третьей республики имела свои особенности: она оставалась страной с большим аграрным сектором и специализировалась на производстве предметов роскоши, отставая по темпам роста тяжёлой промышленности. Ключевой чертой стал «ростовщический империализм»: главной статьей экспорта был не вывоз товаров, а вывоз капитала, то есть предоставление займов другим странам. Это привело к доминированию финансовой олигархии нескольких крупнейших банков («Креди Лионе», «Генеральное общество»). Промышленные же монополии существовали в более мягких формах картелей и синдикатов, а не трестов.",
    "Билет 58: Революция Мэйдзи и «открытие» Японии: политические и экономические последствия": "В 1853 году американская эскадра коммодора Перри насильственно прервала двухсотлетнюю изоляцию Японии, навязав ей неравноправные договоры. Это унижение подорвало авторитет сёгуната и привело к Реставрации Мэйдзи (1868) — буржуазной революции «сверху», проведённой реформаторским крылом самураев. Были проведены коренные реформы: ликвидирована феодальная раздробленность, создана армия по прусскому образцу, проведена индустриализация под контролем государства. В итоге Япония избежала колонизации и превратилась в мощную индустриальную державу.",
    "Билет 59: Основные проблемы развития индустриального общества Европы и Америки в ХІХ – начале ХХ в.": "Зрелое индустриальное общество столкнулось с рядом проблем. В экономике это были рост монополий (картелей, трестов), душивших конкуренцию, и регулярные циклические кризисы перепроизводства. В социальной сфере — стремительная хаотичная урбанизация и обострение «рабочего вопроса» из-за тяжёлых условий труда, что привело к росту профсоюзов и социалистических партий. В политике возник агрессивный национализм, который обострял конфликты как внутри многонациональных империй (Австро-Венгрия, Британия), так и на международной арене, подпитывая гонку за колонии.",
    "Билет 60: «Опиумные» войны, их место и значение в истории Китая": "«Опиумные» войны были вызваны стремлением Британии исправить торговый дисбаланс с Китаем за счёт контрабандной торговли опиумом, который выращивался в Индии. Первая война (1839-1842) завершилась унизительным Нанкинским договором, по которому Китай открывал порты для торговли и отдавал Британии Гонконг. Вторая война (1856-1860) с участием Британии и Франции привела к легализации торговли опиумом. В результате этих войн Китай превратился в полуколонию, что подорвало авторитет династии Цин и стало одной из причин кровопролитного Восстания тайпинов.",
    "Билет 61: Становление и специфика монополистического капитализма в США в конце XIX - начале ХХ в.": "Специфика монополистического капитализма в США заключалась в доминировании жёсткой формы объединения — треста, где совет управляющих получал полный контроль над группой компаний. Классическими примерами стали нефтяной трест «Standard Oil» Джона Рокфеллера и стальной «U.S. Steel» Эндрю Карнеги. Общественное недовольство привело к принятию антитрестовского Закона Шермана (1890), реальная борьба с монополиями по которому началась при Теодоре Рузвельте.",
    "Билет 62: Особенности социального и внешнеполитического развития Великобритании в Викторианскую эпоху (1837-1901)": "Викторианское общество было строго иерархичным, где доминирующим классом стала буржуазия, но и старая аристократия сохраняла огромное влияние. Во внешней политике Британия придерживалась двух разных курсов: в Европе — политики «блестящей изоляции», избегая долгосрочных союзов и выступая «балансиром». В остальном мире, наоборот, велась активнейшая колониальная экспансия, в ходе которой была создана огромная Британская империя, над которой «никогда не заходило солнце» (подчинение Индии, «драка за Африку»).",
    "Билет 63: Монополизация в промышленности и финансах Великобритании конца XIX – начала ХХ в. и ее особенности": "Процесс монополизации в Британии начался позже, чем у конкурентов, и был тесно связан с её статусом финансовой и колониальной державы. Наиболее монополизированной была финансовая сфера, где доминировала «Большая пятёрка» лондонских банков (Midland, Lloyds и др.). В промышленности монополии концентрировались в сферах эксплуатации колониальных ресурсов (алмазная империя Сесиля Родса) и в военно-промышленном комплексе (судостроительные гиганты «Vickers», «Armstrong Whitworth»), выполнявшем заказы для флота.",
    "Билет 64: Причины и последствия промышленного подъема середины ХІХ в. в Германии": "Промышленный подъём в Германии, начавшийся позже, чем у соседей, был очень быстрым благодаря таким факторам, как отмена крепостного права и создание Таможенного союза 1834 года. Главным двигателем стала «железнодорожная революция», создавшая огромный спрос на металл и уголь, а спецификой — активная роль государства и банков в финансировании индустриализации. Пик подъёма, «эра грюндерства», наступил после победы над Францией (1871) и получения 5-миллиардной контрибуции, которая вызвала инвестиционный бум и превратила Германию в ведущую индустриальную державу континента.",
    "Билет 65: Синьхайская революция в Китае": "Синьхайская революция (1911-1912) была вызвана кризисом маньчжурской династии Цин, дискредитированной военными поражениями и превращением Китая в полуколонию. Идейным лидером стал Сунь Ятсен, основавший партию Гоминьдан и выдвинувший «Три народных принципа» (национализм, народовластие, народное благосостояние). Начавшись с Учанского восстания, революция привела к отречению последнего императора и провозглашению республики, но революционеры были вынуждены уступить власть генералу Юань Шикаю, который установил военную диктатуру.",
    "Билет 66: Социально-экономическое и политическое развитие Великобритании в начале ХХ в. (до 1918 г.)": "В начале ХХ века Британия утратила промышленное лидерство, уступив США и Германии, что было вызвано технической отсталостью и экспортом капитала вместо модернизации. Это заставило пришедших к власти либералов во главе с Дэвидом Ллойд Джорджем провести масштабные социальные реформы: «Народный бюджет» 1909 г. ввёл прогрессивный налог, на средства от которого были созданы первые пенсии и пособия по безработице. Вето Палаты лордов на бюджет привело к конституционному кризису, который завершился принятием Акта о Парламенте 1911 г., утвердившим верховенство Палаты общин.",
    "Билет 67: Англо-бурские войны": "Англо-бурские войны велись между Британской империей и бурами (потомками голландских колонистов) в Южной Африке. Вторая война (1899-1902) стала войной за передел мира, её главной причиной было открытие богатейших месторождений золота и алмазов на землях буров. В ходе войны британцы впервые массово применили тактику «выжженной земли» и концентрационные лагеря для мирного населения. Война завершилась победой Британии и включением бурских республик в состав империи, но обострила её противоречия с Германией, став одним из прологов Первой мировой войны.",
    "Билет 68: Балканские войны (1912-1913)": "Первая Балканская война (1912) была успешной войной Балканского союза (Сербия, Болгария, Греция, Черногория) против Османской империи за освобождение Македонии и Фракии. Однако союзники немедленно начали конфликтовать из-за «дележа добычи», что привело ко Второй (межсоюзнической) войне (1913), в которой Болгария напала на Сербию и Грецию. В результате Болгария была разгромлена, а Сербия значительно усилилась, что стало прямой угрозой для Австро-Венгрии. Эти войны превратили Балканы в «пороховой погреб Европы», столкнув интересы России и Австро-Венгрии и сделав мировую войну неизбежной.",
    "Билет 69: Марокканские кризисы": "Марокканские кризисы (1905-1906 и 1911 гг.) были попытками Германии разрушить англо-французскую Антанту и помешать установлению французского контроля над Марокко. Первый кризис был спровоцирован визитом кайзера Вильгельма II в Танжер, но на Альхесирасской конференции Германия потерпела дипломатическое поражение, так как Британия твёрдо поддержала Францию. Второй кризис («прыжок 'Пантеры'» в Агадир) также провалился из-за жёсткой позиции Британии и лишь укрепил Антанту, подстегнул гонку вооружений и приблизил мировую войну.",
    "Билет 70: Боснийский кризис 1908-1909 гг.": "Боснийский кризис был вызван односторонней аннексией Австро-Венгрией Боснии и Герцеговины, которые она оккупировала с 1878 года. Этот шаг был предпринят, чтобы опередить младотурецкую революцию в Стамбуле и нанести удар по планам Сербии создать «Великую Сербию». Кризис обострился, когда Германия в ультимативной форме потребовала от России признать аннексию, угрожая войной. Не готовая к войне после поражения от Японии, Россия была вынуждена уступить, что стало для неё «дипломатической Цусимой» и до предела накалило обстановку в Европе.",
    "Билет 71: Германская империя в 1871-1914 гг. Преимущества единого государства. Идеологическая борьба.": "Создание единой Германской империи в 1871 г. дало мощный толчок её развитию благодаря ликвидации внутренних таможен, унификации инфраструктуры и получению 5-миллиардной контрибуции от Франции. Внутренняя политика канцлера Бисмарка была направлена на подавление сил, которые он считал угрозой единству. Он провёл «Культуркампф» против влияния католической церкви и ввёл «Исключительный закон» против социалистов. Одновременно, чтобы перехватить лозунги у социалистов, Бисмарк провёл передовые социальные реформы, заложив основы государственного социального страхования.",
    "Билет 72: Германская империя в 1871-1914 гг. Внешняя, колониальная и военная политика.": "Внешняя политика Бисмарка (1871-1890) была направлена на изоляцию Франции и предотвращение войны на два фронта через создание системы союзов (Союз трёх императоров, Тройственный союз, «Перестраховочный договор» с Россией). После 1890 г. кайзер Вильгельм II перешёл к агрессивной «мировой политике», отказался от союза с Россией и начал гонку военно-морских вооружений с Англией. Германия активно включилась в колониальную экспансию в Африке и на Тихом океане. В военной сфере был разработан «план Шлиффена» для войны на два фронта.",
    "Билет 73: Международные отношения в 1870-1914 гг.": "Период 1870-1914 гг. был временем «вооруженного мира», когда Европа раскололась на два враждебных блока. С одной стороны — Тройственный союз (Германия, Австро-Венгрия, Италия), стремившийся к переделу мира. С другой — Антанта (Франция, Россия, Великобритания), сложившаяся как ответ на германскую угрозу. Ключевыми противоречиями были англо-германское морское и экономическое соперничество, франко-германское из-за Эльзаса и Лотарингии и австро-русское на Балканах. Серия кризисов (Марокканские, Боснийский, Балканские войны) довела напряжённость до предела, и Сараевское убийство в 1914 г. стало поводом для начала Первой мировой войны.",
}

# --- Functions ---

@st.cache_data
def generate_audio(text):
    """Generates audio from text and returns it as a byte object."""
    audio_bytes = io.BytesIO()
    try:
        tts = gTTS(text=text, lang='ru', slow=False)
        tts.write_to_fp(audio_bytes)
        audio_bytes.seek(0)
        return audio_bytes
    except Exception:
        return None

def initialize_session_state():
    """Initializes session state variables if they don't exist."""
    if 'card_keys' not in st.session_state:
        st.session_state.card_keys = list(flashcard_data.keys())
    
    if 'total_cards' not in st.session_state:
        st.session_state.total_cards = len(st.session_state.card_keys)

    if 'current_index' not in st.session_state:
        st.session_state.current_index = 0

    if 'is_flipped' not in st.session_state:
        st.session_state.is_flipped = False

    if 'card_status' not in st.session_state:
        st.session_state.card_status = {key: "Не просмотрено" for key in st.session_state.card_keys}

def apply_range(start_num, end_num):
    """Filters cards based on the selected range."""
    # Adjust for 0-based indexing
    start_idx = start_num - 1
    end_idx = end_num
    
    all_keys = list(flashcard_data.keys())
    if 0 <= start_idx < end_idx <= len(all_keys):
        st.session_state.card_keys = all_keys[start_idx:end_idx]
        st.session_state.total_cards = len(st.session_state.card_keys)
        st.session_state.current_index = 0
        st.session_state.is_flipped = False
    else:
        st.sidebar.error("Неверный диапазон. Пожалуйста, выберите корректные номера.")

def next_card():
    """Moves to the next card in the filtered list."""
    if st.session_state.current_index < st.session_state.total_cards - 1:
        st.session_state.current_index += 1
        st.session_state.is_flipped = False

def prev_card():
    """Moves to the previous card in the filtered list."""
    if st.session_state.current_index > 0:
        st.session_state.current_index -= 1
        st.session_state.is_flipped = False

def mark_status(status):
    """Marks the current card with a status ('Запомнено' or 'Нужно повторить')."""
    current_key = st.session_state.card_keys[st.session_state.current_index]
    st.session_state.card_status[current_key] = status

# --- UI Layout ---

st.set_page_config(page_title="Интерактивные Аудио-Карточки", layout="wide", page_icon="🗂️")
initialize_session_state()

# --- Sidebar Controls ---
with st.sidebar:
    st.header("⚙️ Настройки")
    
    # Range selection
    st.subheader("Диапазон карточек")
    total_cards_overall = len(flashcard_data)
    start_num = st.number_input("Начало", min_value=1, max_value=total_cards_overall, value=1, step=1)
    end_num = st.number_input("Конец", min_value=1, max_value=total_cards_overall, value=65, step=1)
    
    if st.button("Применить диапазон", use_container_width=True):
        apply_range(start_num, end_num)
        st.rerun()

    # Progress summary
    st.header("📊 Прогресс")
    remembered_count = list(st.session_state.card_status.values()).count("Запомнено")
    repeat_count = list(st.session_state.card_status.values()).count("Нужно повторить")
    
    st.metric(label="✅ Запомнено", value=f"{remembered_count} / {st.session_state.total_cards}")
    st.metric(label="🔄 Повторить", value=f"{repeat_count} / {st.session_state.total_cards}")
    
    # Reset button
    if st.button("Сбросить прогресс", use_container_width=True):
        st.session_state.card_status = {key: "Не просмотрено" for key in list(flashcard_data.keys())}
        st.rerun()

# --- Main Flashcard Area ---
st.title("🗂️ Интерактивные Аудио-Карточки по Истории")

# Check if the card list is empty
if not st.session_state.card_keys:
    st.warning("Нет карточек для отображения. Пожалуйста, выберите и примените диапазон в боковой панели.")
else:
    # Get current card details
    current_key = st.session_state.card_keys[st.session_state.current_index]
    current_answer = flashcard_data[current_key]
    current_status = st.session_state.card_status[current_key]

    # Progress bar
    progress_value = (st.session_state.current_index + 1) / st.session_state.total_cards
    st.progress(progress_value, text=f"Карточка {st.session_state.current_index + 1} из {st.session_state.total_cards}")

    # Flashcard container
    card_placeholder = st.empty()

    # Determine which side of the card to show
    if not st.session_state.is_flipped:
        # --- FRONT OF THE CARD ---
        with card_placeholder.container():
            st.markdown(f"**Статус:** {current_status}")
            with st.container(height=300, border=True):
                st.subheader("Вопрос:")
                st.write(current_key)
            
            col1, col2 = st.columns([3, 1])
            with col1:
                if st.button("Перевернуть на ответ ↩️", use_container_width=True):
                    st.session_state.is_flipped = True
                    st.rerun()
            with col2:
                if st.button("▶️ Озвучить вопрос", use_container_width=True):
                    audio_file = generate_audio(current_key)
                    if audio_file:
                        st.audio(audio_file, format='audio/mp3', autoplay=True)
                    else:
                        st.error("Не удалось сгенерировать аудио для вопроса.")

    else:
        # --- BACK OF THE CARD ---
        with card_placeholder.container():
            st.markdown(f"**Статус:** {current_status}")
            with st.container(height=300, border=True):
                st.subheader("Ответ:")
                st.write(current_answer)
                
            col1, col2 = st.columns([3, 1])
            with col1:
                if st.button("Перевернуть на вопрос ↪️", use_container_width=True):
                    st.session_state.is_flipped = False
                    st.rerun()
            with col2:
                if st.button("▶️ Озвучить ответ", use_container_width=True):
                    audio_file = generate_audio(current_answer)
                    if audio_file:
                        st.audio(audio_file, format='audio/mp3', autoplay=True)
                    else:
                        st.error("Не удалось сгенерировать аудио для ответа.")
    
    st.divider()

    # --- Navigation and Status Buttons ---
    nav_col1, nav_col2 = st.columns(2)
    with nav_col1:
        st.button("⬅️ Предыдущая", on_click=prev_card, use_container_width=True, disabled=(st.session_state.current_index == 0))
    with nav_col2:
        st.button("Следующая ➡️", on_click=next_card, use_container_width=True, disabled=(st.session_state.current_index == st.session_state.total_cards - 1))
        
    status_col1, status_col2 = st.columns(2)
    with status_col1:
        st.button("✅ Я это знаю!", on_click=mark_status, args=("Запомнено",), use_container_width=True)
    with status_col2:
        st.button("🔄 Нужно повторить", on_click=mark_status, args=("Нужно повторить",), use_container_width=True)

